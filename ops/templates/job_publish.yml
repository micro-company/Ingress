.job_template_publish: &job_publish
  type: publish
  script:
  # Install tool
  - apk add --no-cache git openssl

  # install Helm
  - wget https://kubernetes-helm.storage.googleapis.com/helm-$HELM_VERSION-linux-amd64.tar.gz
  - tar -xvf helm-$HELM_VERSION-linux-amd64.tar.gz
  - mv linux-amd64/helm /usr/local/bin/helm
  - helm init -c

  # update charts
  - git clone https://$GITHUB_USER:$GITHUB_PASSWORD@github.com/micro-company/charts.git
  - helm package $HELM_PATH
  - mv *.tgz charts/docs
  - helm repo index charts/docs
  - cd charts
  - git add .
  - git config --global user.email "authmicroservice@gmail.com"
  - git config --global user.name "CI bot"
  - git commit -m "Add/Update chart $CI_PROJECT_NAME:$CI_COMMIT_TAG"
  - git push
  except:
  - branches
  when: on_success
