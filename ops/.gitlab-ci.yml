include:
- templates/job_publish
- templates/job_deploy
- templates/job_lint

image: docker:latest
services:
- docker:dind

variables:
  RELEASE_NAME: ingress
  HELM_PATH: ops/Helm/ingress
  HELM_VERSION: v2.7.2
  KUBE_CONTEXT: minikube

stages:
- best_practices
- publish
- deploy

chart:staging:
  type: best_practices
  <<: *job_lint

chart:staging:
  <<: *job_publish
  only:
  - /^(?:0|[1-9]\d*)\.(?:0|[1-9]\d*)\.(?:0|[1-9]\d*)-rc(?:0|[1-9]\d*)$/

deploy:staging:
  <<: *job_deploy
  only:
  - /^(?:0|[1-9]\d*)\.(?:0|[1-9]\d*)\.(?:0|[1-9]\d*)-rc(?:0|[1-9]\d*)$/
